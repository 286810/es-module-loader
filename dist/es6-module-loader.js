/*
 *  es6-module-loader v1.0.0-alpha
 *  https://github.com/ModuleLoader/es6-module-loader
 *  Copyright (c) 2015 Guy Bedford, Luke Hoban, Addy Osmani; Licensed MIT
 */

!function(a){function b(a,b){var c;if(a instanceof Error){var c=new a.constructor(a.message,a.fileName,a.lineNumber);c.message=a.message+"\n	"+b,c.stack=a.stack}else c=a+"\n	"+b;return c}function c(){this._loader={loaderObj:this,resolve:void 0,fetch:void 0,translate:void 0,instantiate:void 0,registry:{}}}function d(a,b,c){return a.registry[b]||(a.registry[b]={key:b,state:y,metadata:c||{},fetch:void 0,translate:void 0,instantiate:void 0,fetchResolve:void 0,translateResolve:void 0,instantiateResolve:void 0,dependencies:void 0,module:void 0,declare:void 0,error:null})}function e(a,b,c){b.fetchResolve?b.fetchResolve(c):b.fetch=Promise.resolve(c),b.fetchResolve=void 0,b.state=Math.max(b.state,z)}function f(a,b,c){b.translateResolve?b.translateResolve(c):b.translate=Promise.resolve(c),b.translateResolve=void 0,b.state=Math.max(b.state,A)}function g(a,b,c,d){if(void 0===c)var e=r(a.loaderObj,b.key,d,b.metadata);else if("function"!=typeof c)throw new TypeError("Instantiate must return an execution function.");b.instantiateResolve?b.instantiateResolve(c):b.instantiate=Promise.resolve(c),b.instantiateResolve=void 0;var f=[];if(void 0===c){b.declare=e.declare;for(var g=0;g<e.deps.length;g++)f.push({key:e.deps[g],value:void 0})}b.dependencies=f,b.module=c,b.state=Math.max(b.state,B)}function h(a,b,c,d){return Promise.resolve(void 0===c&&loadTranspiler(a.loaderObj)).then(function(){g(a,b,c,d)})}function i(a,c,f,g){return g=g||d(a,c,f),g.error?Promise.reject(g.error):g.state===D?Promise.reject(new Error(c+" cannot be fetched as it is already linked.")):g.fetch?g.fetch:(Promise.resolve().then(function(){return a.fetch.call(a.loaderObj,c,g.metadata)}).then(function(b){e(a,g,b)},function(a){throw b(a,"Fetching "+c)})["catch"](function(a){g.error=g.error||a}).then(function(){g.error&&g.fetchResolve&&g.fetchResolve(Promise.reject(g.error))}),g.fetch=new Promise(function(a){g.fetchResolve=a}))}function j(a,c,e,g){return g=g||d(a,c,e),g.error?Promise.reject(g.error):g.state===D?Promise.reject(new Error(c+" cannot initiate translate as it is already linked.")):g.translate?g.translate:(i(a,c,null,g).then(function(d){return Promise.resolve().then(function(){return a.translate.call(a.loaderObj,c,d,g.metadata)}).then(function(b){f(a,g,b)},function(a){throw b(a,"Translating "+c)})})["catch"](function(a){g.error=g.error||a}).then(function(){g.error&&g.translateResolve&&g.translateResolve(Promise.reject(g.error))}),g.translate=new Promise(function(a){g.translateResolve=a}))}function k(a,c,e,f){return f=f||d(a,c,e),f.error?Promise.reject(f.error):f.state===D?Promise.reject(new Error(c+" cannot instantiate as it is already linked.")):f.instantiate?f.instantiate:(j(a,c,null,f).then(function(d){return Promise.resolve().then(function(){return a.instantiate.call(a.loaderObj,c,d,f.metadata)}).then(function(b){return h(a,f,b,d)},function(a){throw b(a,"Instantiating "+c)})})["catch"](function(a){f.error=f.error||a}).then(function(){f.error&&f.instantiateResolve&&f.instantiateResolve(Promise.reject(f.error))}),f.instantiate=new Promise(function(a){f.instantiateResolve=a}))}function l(a,c,e,f){return f=f||d(a,c,e),f.state>B?f:k(a,c,null,f).then(function(){f.state=Math.max(f.state,C);for(var e=[],g=0;g<f.dependencies.length;g++)(function(b){var f={};e.push(Promise.resolve(a.resolve.call(a.loaderObj,b.key,c,f)).then(function(c){var e=d(a,c,f);return b.value=e,l(a,c,null,e)}))})(f.dependencies[g]);return Promise.all(e)["catch"](function(a){throw a=b(a,"Loading "+c),f.error=f.error||a,a})})}function m(a,b,c,e){return e=e||d(a,b,c),e.error?Promise.reject(e.error):e.state===D?Promise.resolve(e):l(a,b,c,e).then(function(){var a=[];o(e,a);for(var b=0;b<a.length;b++){var c=a[b];c.state==C&&"function"==typeof c.module&&(p(c),c.state=D)}return e.state==C&&declareModule(e),e})["catch"](function(a){throw e.error=a,a})}function n(a,c,e,f){return f=f||d(a,c,e),m(a,c,e,f).then(function(a){var d=a.module;if(d instanceof q)return d;var e=ensureModuleExecution(d,[]);if(e)throw e=b(e,"Error evaluating "+c),a.error=e,e;return d.module},function(a){throw f.error=f.error||a,a})}function o(a,b){if(-1==v.call(b,a)){b.push(a);for(var c=0;c<a.dependencies.length;c++)o(a.dependencies[c].value,b)}}function p(a){if(a.error)throw a.error;try{a.module=a.module()}catch(b){throw a.error=b,b}}function q(a){for(var b in a)this[b]=a[b]}function r(){throw new TypeError("Native ES Module support not included in this loader.")}function s(){}function t(a,b){if("string"!=typeof a)throw new TypeError("URL must be a string");var c=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(?:\/\/(?:([^:@\/?#]*)(?::([^:@\/?#]*))?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);if(!c)throw new RangeError;var d=c[1]||"",e=c[2]||"",f=c[3]||"",g=c[4]||"",h=c[5]||"",i=c[6]||"",j=c[7]||"",k=c[8]||"",l=c[9]||"";if(void 0!==b){var m=b instanceof t?b:new t(b),n=""===d&&""===g&&""===e;n&&""===j&&""===k&&(k=m.search),n&&"/"!==j.charAt(0)&&(j=""!==j?(""===m.host&&""===m.username||""!==m.pathname?"":"/")+m.pathname.slice(0,m.pathname.lastIndexOf("/")+1)+j:m.pathname);var o=[];j.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?o.pop():o.push(a)}),j=o.join("").replace(/^\//,"/"===j.charAt(0)?"/":""),n&&(i=m.port,h=m.hostname,g=m.host,f=m.password,e=m.username),""===d&&(d=m.protocol)}"file:"==d&&(j=j.replace(/\\/g,"/")),this.origin=d+(""!==d||""!==g?"//":"")+g,this.href=d+(""!==d||""!==g?"//":"")+(""!==e?e+(""!==f?":"+f:"")+"@":"")+g+j+k+l,this.protocol=d,this.username=e,this.password=f,this.host=g,this.hostname=h,this.port=i,this.pathname=j,this.search=k,this.hash=l}function u(){}var v=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},w="object"==typeof exports&&"function"==typeof require,x="undefined"!=typeof process&&!!process.platform.match(/^win/),y=0,z=1,A=2,B=3,C=4,D=5;c.prototype["import"]=function(a,c){var d=this._loader,e={};return Promise.resolve().then(function(){return d.resolve.call(d.loaderObj,a,c,e)})["catch"](function(d){throw b(d,"Resolving "+a+(c?", "+c:""))}).then(function(a){return n(d,a,e)})},c.prototype.resolve=function(a,b,c){var d=this._loader;return d.resolve.call(d.loaderObj,a,b,c||{})},c.prototype.load=function(a,b,c){var d=this._loader;if("fetch"==b)return i(d,a,c);if("translate"==b)return j(d,a,c);if("instantiate"==b)return l(d,a,c).then(function(a){return a.module instanceof q?void 0:a.module});if("link"==b)return m(d,a,c).then(function(){});if(b&&"ready"!=b)throw new TypeError("Invalid stage "+b);return n(d,a,c).then(function(a){return a.module})},c.prototype.provide=function(a,b,c,g){var i=this._loader,j=d(i,a,g);if("fetch"==b){if(j.state>y)throw new TypeError(a+" has already been fetched.");e(i,j,c)}else if("translate"==b){if(j.state>z)throw new TypeError(a+" has already been translated.");f(i,j,c)}else{if("instantiate"!=b)throw new TypeError("Invalid stage "+b);if(j.state>A)throw new TypeError(a+" has already been instantiated.");e(i,j,void 0),f(i,j,void 0),j.translate.then(function(a){h(i,j,c,a)})}},c.prototype.error=function(){},c.prototype.lookup=function(a){var b=this._loader,c=b.registry[a];if(!c)return null;var d;return c.state==y?d="fetch":c.state==z?d="translate":c.state==A?d="instantiate":c.state==C?d="link":c.state==D&&(d="ready"),{state:d,metadata:c.metadata,fetch:c.fetch&&Promise.resolve(c.fetch),translate:c.translate&&Promise.resolve(c.translate),instantiate:c.instantiate&&Promise.resolve(c.instantiate),module:c.state==D&&(c.module instanceof q?c.module:c.module.module),error:c.error}},c.prototype.install=function(a,b){var c=this._loader;if(c.registry[a])throw new TypeError(a+" is already defined in the Loader registry.");if(!(b instanceof q))throw new TypeError("Install must provide a valid Module object.");c.registry[a]={key:a,state:D,metadata:metadata,fetch:void 0,translate:void 0,instantiate:void 0,dependencies:void 0,module:b,declare:void 0,error:null}},c.prototype.uninstall=function(a){var b=this._loader,c=b.registry[a];if(!c)throw new TypeError(a+" is not defined in the Loader registry.");if(c.state<C)throw new TypeError(a+" is still loading.");delete b.registry[a]},c.prototype.cancel=function(a){var b=this._loader,c=b.registry[a];if(!c)throw new TypeError(a+" does not exist.");if(c.state>=C)throw new TypeError(a+" is already past linking.");delete b.registry[a]};var E=["resolve","fetch","translate","instantiate"];c.prototype.hook=function(a,b){var c=this._loader;if(-1==v.call(E,a))throw new TypeError(a+" is not a valid hook.");return b?void(c[a]=b):c[a]};var F,G;if("undefined"!=typeof XMLHttpRequest)G=function(a,b,c){function d(){b(f.responseText)}function e(){c(new Error("GET "+a+" "+f.status+" ("+f.statusText+")"))}var f=new XMLHttpRequest,g=!0,h=!1;if(!("withCredentials"in f)){var i=/^(\w+:)?\/\/([^\/]+)/.exec(a);i&&(g=i[2]===window.location.host,i[1]&&(g&=i[1]===window.location.protocol))}g||"undefined"==typeof XDomainRequest||(f=new XDomainRequest,f.onload=d,f.onerror=e,f.ontimeout=e,f.onprogress=function(){},f.timeout=0,h=!0),f.onreadystatechange=function(){4===f.readyState&&(200===f.status||0==f.status&&f.responseText?d():e())},f.open("GET",a,!0),h&&setTimeout(function(){f.send()},0),f.send(null)};else{if(!w)throw new TypeError("No environment fetch API available.");var H;G=function(a,b,c){if("file:///"!=a.substr(0,8))throw"Only file URLs of the form file: allowed running in Node.";H=H||require("fs"),a=x?a.replace(/\//g,"\\").substr(8):a.substr(7),H.readFile(a,function(a,d){a?c(a):b(d+"")})}}var I=function(){function a(a){if(b[a])return b[a];var c,d=0;for(var e in b){var f=e.split("*");if(f.length>2)throw new TypeError("Sites entry "+e+" contains multiple wildcards.");1!=f.length&&e.split("/").length>=d&&e.substr(0,f[0].length)===a.substr(0,f[0].length)&&e.substr(e.length-f[1].length)===f[1]&&(c=b[e].replace("*",a.substr(f[0].length,a.length-e.length+1)),d=e.split("/").length)}return c}c.call(this,arguments);var b={};this.site=function(a){for(var c in a)b[c]=a[c]},this.site.get=function(a){return b[a]},this.site.set=function(a,c){b[a]=c},this.site.has=function(a){return!!b[a]},this.site["delete"]=function(a){delete b[a]},this.hook("resolve",function(b,c){var d=a(b);return(d||!c)&&(c=J),new t(d||b,c).href}),this.hook("fetch",function(a){return new Promise(function(b,c){G(a,b,c)})}),this.hook("translate",function(a,b){return b}),this.hook("instantiate",s),this.transpiler&&setupTranspilers(this)};u.prototype=c.prototype,I.prototype=new u;var J;"undefined"!=typeof document&&document.baseURI?J=document.baseURI:"undefined"!=typeof document&&document.getElementsByTagName?(J=document.getElementsByTagName("base")[0],J=J&&J.href):"undefined"!=typeof location&&location.href&&(J=location.href),J?(J=J.split("#")[0].split("?")[0],J=J.substr(0,J.lastIndexOf("/")+1)):"undefined"!=typeof process&&process.cwd&&(J="file://"+(x?"/":"")+process.cwd()+"/",x&&(J=J.replace(/\\/g,"/"))),J=new t(J);var K;F=new I,F.constructor=I,function(b){K=b.Reflect||{},K.Loader=K.Loader||c,K.Module=K.Module||q,K.global=K.global||a,b.LoaderPolyfill=c,b.ModulePolyfill=q,b.Reflect=K,b.System=F}(w?exports:a)}("undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:global);
//# sourceMappingURL=es6-module-loader.js.map